package com.weshopify.platform.outbound;

import java.util.Base64;

import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpMethod;
import org.springframework.http.MediaType;
import org.springframework.web.client.RestTemplate;

import com.weshopify.platform.model.WSO2UserAuthnBean;

import jakarta.validation.Valid;

public class IamAuthnCommunicator {
	@Autowired
	RestTemplate restTemplate;
	
	@Value("${weshopify.oauth2.uri}")
	private String authnUri;
	private String username;
	private String password;
	@Value("${weshopify.oauth2.clientId}")
	private String clientId;
	@Value("${weshopify.oauth2.clientSecret}")
	private String clientSecret;
	public String authenticate(WSO2UserAuthnBean authnBean) {
		restTemplate.exchange(authnUri, HttpMethod.POST, , String.class);
		return null;
	}

	public HttpEntity<String> prepareRequestBody(String roleBeanPayload) {
		HttpEntity<String> requestBody = null;
		String combinedCreds = iam_user_name + ":" + iam_password;

		String encodedAdminCreds = Base64.getEncoder().encodeToString(combinedCreds.getBytes());
//		log.info(encodedAdminCreds);
		HttpHeaders headers = new HttpHeaders();
		headers.add("Authorization", "Basic " + encodedAdminCreds);

		if (StringUtils.isBlank(roleBeanPayload) || StringUtils.isEmpty(roleBeanPayload)) {
			requestBody = new HttpEntity<>(headers);
		} else {
			headers.add("Content-Type", MediaType.APPLICATION_JSON_VALUE);
			requestBody = new HttpEntity<>(roleBeanPayload, headers);
		}

		return requestBody;
	}
}
